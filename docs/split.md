## 检索增强生成（Retrieval Augmented Generation, RAG）

检索增强生成**引用**是指提供外部知识给大预言模型，对于用户提问，通过信息检索技术加载与问题相关的信息，LLM利用这些信息回答问题。下图是检索增强生成的简单示意图。检索增强生成可以解决大模型在以下四个方面的欠缺。

1. 长尾知识**引用**

   LLM的海量训练数据也无法覆盖所有知识，在有限的参数量下，LLM也无法完全记忆所有知识。实践证明，LLM对长尾知识回答的准确性相比于通用知识差不少**引用**。

2. 数据时效性

   训练数据中不包含未来的事实，LLM的知识存在过时的情况。

3. 私有数据

   训练数据都是公开的数据，LLM没有未学习过的私有知识，如企业内部规章制度，特定领域业务知识等。

4. 来源和可解释性

   LLM的生成结果是不可解释的，没有来源和参考依据，使用检索增强的方式可以追溯到信息来源。

## 知识库构建

**流程图**

### 文档处理

外部文档包括txt、pdf、word、html等格式，部分格式的数据是结构化的，可以比较完整地提取出文档的标题、段落、表格中的信息，如html、word；部分格式没有或无法识别到样式信息，是非结构化的，如pdf，txt，pdf中还可以包含图片、表格等信息。

知识库的质量是检索和生成的基础，文档切分需要尽可能保证知识的完整性和关联性。对于不同格式内容的文档，要采取不同的切分策略，由于向量模型和LLM输入长度的的限制，分块大小也是需要考虑的重要因素、文档的标题索引是对段落信息的浓缩，可以提高检索的准确性。

规章制度主要是pdf格式，本文主要研究了pdf文档的

#### 基于规则

正则表达式

#### 基于智能识别模型

##### 版面恢复

OCR识别标题、段落、页眉、表格等

##### 表格及流程图识别

表格内容提取

多模态模型识别流程图、设计图

### 多模态数据

除了最常见的各种格式文档外，外部数据还可能是多模态的，比如视频、音频、图片等格式，需要专门的多模态模型识别。

## 检索策略

流程图

### 全文检索

倒排索引

BM25算法

专业词汇、停用词、同义词处理

### 向量检索

embeding模型

MTEB

多问题+RRF

### 语义重排

### 问题预热

### 向量缓存

## 实验结果

### 检索策略对比

|                            | top1 | top5 | top10 |
| -------------------------- | ---- | ---- | ----- |
| 向量检索                   |      |      |       |
| BM25+向量检索+重排         |      |      |       |
| BM25+多路向量检索+RRF+重排 |      |      |       |

### 向量模型微调前后对比

|      |      |      |
| ---- | ---- | ---- |
|      |      |      |
|      |      |      |
|      |      |      |

### 国产化与非国产化环境响应时间对比

|      |      |      |
| ---- | ---- | ---- |
|      |      |      |
|      |      |      |
|      |      |      |

