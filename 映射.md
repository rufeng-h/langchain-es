- 动态映射。无须显示指定文档字段数据类型，直接添加数据即可，es会自动推断数据类型，一般在测试时使用，生产过程避免使用字段推断。

- 显式映射。创建索引时显式指定字段和数据类型。

  索引创建后不能修改字段名（可以添加alias），不能修改数据类型，可以添加新的字段

- 运行时字段。在查询时确定数据类型，由于不会提前索引数据，可以节省存储空间以及提供更灵活的映射操作，但是在部分搜索API中的表现不同，并且由于运行时确定字段，性能上存在一定损失。

### mapping配置

- analyzer，分词器，仅用于text字段，如果不显式指定search_analyzer，将同时应用于索引阶段和检索阶段。
- search_quote_analyzer，phrase查询，不删除停止词。
- coere，数据类型自动转换，比如字符串转整数，浮点数截断为字符串，设置为false，数据类型与字段值类型必须强制符合。可以对字段单独设置，也可以对索引设置。
- copy_to，当需要对多个字段进行检索时（组合条件为或）,可以使用bool查询，但更建议使用copy_to组合字段，既简单又高效。需要注意以下几点
  1. copy过去的是字段值，而不是分词后的term。
  2. copy_to的字段不会包含在_source中，可以理解为仅用于搜索的组合字段。
  3. 同一字段可以copy到多个组合字段中，数组表示即可。
  4. 在目标组合字段未指定类型的情况下，如果dynamic为true，使用自动类型推断；如果dynamic为false，copy_to无效；如果dynamic为strict，则会抛出错误。
  5. copy_to不支持值为对象的数据类型，比如date_range。
  6. copy到组合数据类型的多个字段最好是同一数据类型，保证搜索行为的一致性，copy_to会忽略原字段的数据类型，对组合的所有字段进行同一种数据类型的检索。

### 数据类型

- Aggregate metric，聚合统计，提前统计聚合的一些值，包含最大值、最小值、数量、和等。

- Alias，别名，为其它字段添加别名。

- Arrays，数组，es中没有专门的数组，任何字段都可以包含0个或者多个值，mapping中指定字段的类型为数组的元素类型，不存在array类型，添加文档时可以写成数组的形式，es可以自动识别。

  数组中所有值必须是同一数据类型，第一个元素的数据类型决定整个数组的数据类型，数组中的null值可以配置为忽略或者null_value类型。

- Binary，二进制，接受base64字符串，默认是不store并且无法检索的。

## 查询

- match，最常用，分词，全文检索。

- match_phrase，与match类似，**但是索引分词和查询分词结果必须相同，包括分词得到的顺序**，可配置参数slop，允许词和词之间出现其他token的数量。

  本人在ik分词测试，需要将analyzer和search_quote_analyzer设置成一样的分词器，才能正确检索出结果。

  match_phrase容易受到停用的影响，不配置ik的停用词影响match搜索，配置之后影响match_phrase，本人使用ik的tokenizer自定义analyzer，但是**ik的tokenizer就完成了中文标点去除、停用词去除以及分词的功能**，无法配置其仅完成分词，需要修改源码。
